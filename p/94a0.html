<!DOCTYPE html>
<html lang="zh">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">



  <meta name="description" content="JVM (3)"/>




  <meta name="keywords" content="Programming Language," />


<meta name="google-site-verification" content="qy4gf0StWj627u-7aIP3WDCLBi3jPYXhm57UC7TUcok" />
<meta name="baidu-site-verification" content="XJoPG7ad2Z" />

<link rel="alternate" hreflang="x-default" href="https://zaf1ro.github.io/p/94a0.html" />
<link rel="alternate" hreflang="zh" href="https://zaf1ro.github.io/p/94a0.html" />




  <link rel="alternate" href="/default" title="Zaf1ro" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.jpeg?v=1.1" />



<link rel="canonical" href="https://zaf1ro.github.io/p/94a0.html"/>


<meta name="description" content="1. 调用函数1.1 调用成员函数public class Test &amp;#123;  int addTwo(int i, int j)&amp;#123;    return i+j;  &amp;#125;  &#x2F;**   * int addTwo(int, int);   * Code: stack&#x3D;2, locals&#x3D;3, args_size&#x3D;3   * 0: iload_1  &#x2F;&#x2F; 从local varia">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM (3)">
<meta property="og:url" content="https://zaf1ro.github.io/p/94a0.html">
<meta property="og:site_name" content="Zaf1ro">
<meta property="og:description" content="1. 调用函数1.1 调用成员函数public class Test &amp;#123;  int addTwo(int i, int j)&amp;#123;    return i+j;  &amp;#125;  &#x2F;**   * int addTwo(int, int);   * Code: stack&#x3D;2, locals&#x3D;3, args_size&#x3D;3   * 0: iload_1  &#x2F;&#x2F; 从local varia">
<meta property="og:locale">
<meta property="article:published_time" content="2017-11-09T13:58:48.000Z">
<meta property="article:modified_time" content="2024-08-20T16:43:04.050Z">
<meta property="article:tag" content="Programming Language">
<meta name="twitter:card" content="summary">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />




    <title>
JVM (3) - Zaf1ro
</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body>
  <nav id="sidebar" class="active on-post">
    <div id="third">
      <div id="sidebar-title">
        <h1 id="sidebar-title-text">
            <a href="/." class="logo">Home</a>
        </h1>
      </div>
      <div id="google-search">
  <script async src="https://cse.google.com/cse.js?cx=009060789867951546370:v3hkcobeuh9"></script>
  <div class="gcse-search"></div>
</div>
      
  <div id="toc">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">1. 调用函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%B0%83%E7%94%A8%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-text">1.1 调用成员函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%B0%83%E7%94%A8%E7%88%B6%E7%B1%BB%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 调用父类函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E8%B0%83%E7%94%A8%E9%9D%99%E6%80%81%E5%87%BD%E6%95%B0"><span class="toc-text">1.3 调用静态函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Constant-Local-Variable%E5%92%8CControl-Construct%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2. Constant, Local Variable和Control Construct的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-int%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">2.1 int类型变量的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-short%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-text">2.2 short类型变量操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-double%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-text">2.3 double类型变量操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Arithmetic"><span class="toc-text">3. Arithmetic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Run-time-Constant-Pool"><span class="toc-text">4. Run-time Constant Pool</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-5"><span class="toc-text">4.1 -1 ~ 5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-128-127"><span class="toc-text">4.2 -128 ~ 127</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-32768-32767"><span class="toc-text">4.3 -32768 ~ 32767</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2147483648-2147483647"><span class="toc-text">4.4 -2147483648 ~ 2147483647</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-long-and-double"><span class="toc-text">4.5 long and double</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9D%A1%E4%BB%B6%E6%8E%A7%E5%88%B6"><span class="toc-text">5. 条件控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-int"><span class="toc-text">5.1 int</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-float-double"><span class="toc-text">5.2 float&#x2F;double</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-break"><span class="toc-text">5.3 break</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-function-parameter"><span class="toc-text">6. function parameter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Class-Object"><span class="toc-text">7. Class Object</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-object-as-parameter"><span class="toc-text">7.1 object as parameter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-call-member-function"><span class="toc-text">7.2 call member function</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Array"><span class="toc-text">8. Array</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-one-dimensional-array-of-primitive-type"><span class="toc-text">8.1 one-dimensional array of primitive type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-one-dimensional-array-with-of-reference"><span class="toc-text">8.2 one-dimensional array with of reference</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-multi-dimensional-array"><span class="toc-text">8.3 multi-dimensional array</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-switch"><span class="toc-text">9. switch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-table"><span class="toc-text">9.1 table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-lookupswitch"><span class="toc-text">9.2 lookupswitch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Member-Variable"><span class="toc-text">10. Member Variable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Declaring-Member-Variable"><span class="toc-text">11. Declaring Member Variable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-throw"><span class="toc-text">11.1 throw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-catch"><span class="toc-text">11.2 catch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-finally"><span class="toc-text">11.3 finally</span></a></li></ol></li></ol>
  </div>

    </div>
  </nav>

    <div id="page">
      <header id="masthead"><div class="site-header-inner">
  
  <button class="nav-mobile-button on-post" id="sidebarCollapse">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"/></svg>
  </button>
  
  


  <nav id="nav-top">
    
      
      <ul id="menu-top" class="nav-top-items on-post">
      
        
          <li class="menu-item">
            <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Zaf1ro">
              
              
                Github
              
            </a>
          </li>
        
      </ul>
    
  </nav>
</div>

      </header>
      <div id="content">
        
  <div class="primary">
    
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          JVM (3)
        
      </h1>
      <time class="post-time">
          11/09/17
      </time>
    </header>

    <div class="post-content">
      <h2 id="1-调用函数"><a href="#1-调用函数" class="headerlink" title="1. 调用函数"></a>1. 调用函数</h2><h3 id="1-1-调用成员函数"><a href="#1-1-调用成员函数" class="headerlink" title="1.1 调用成员函数"></a>1.1 调用成员函数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="title function_">addTwo</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i+j;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * int addTwo(int, int);</span></span><br><span class="line"><span class="comment">   * Code: stack=2, locals=3, args_size=3</span></span><br><span class="line"><span class="comment">   * 0: iload_1  // 从local variable array[1]取值, [0]为this</span></span><br><span class="line"><span class="comment">   * 1: iload_2</span></span><br><span class="line"><span class="comment">   * 2: iadd</span></span><br><span class="line"><span class="comment">   * 3: ireturn</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    t.addTwo(<span class="number">10</span>,<span class="number">11</span>);</span><br><span class="line">    addTwoStatic(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * public static void main</span></span><br><span class="line"><span class="comment">   * Code: stack=3, locals=2, args_size=1</span></span><br><span class="line"><span class="comment">   * 0: new #2    // 在heap上创建于一个class对象, 并将objectref放入operand stack中</span></span><br><span class="line"><span class="comment">   * 3: dup       // 复制栈顶元素并放入栈顶</span></span><br><span class="line"><span class="comment">   * 4: invokespecial #3  // 调用Test的初始化函数init()</span></span><br><span class="line"><span class="comment">   *                      // 由于init无参数, 只将operand stack中的objectref取出并赋给init</span></span><br><span class="line"><span class="comment">   * 7: astore_1          // 将operand stack顶部元素取出并存入到local variable的索引1位置上</span></span><br><span class="line"><span class="comment">   * 8: aload_1           // 将local variable索引1位置上的元素放入operand stack顶部</span></span><br><span class="line"><span class="comment">   * 9: bipush 10         // 将常量10放入operand stack</span></span><br><span class="line"><span class="comment">   * 11: bipush 11        // 将常量11放入operand stack</span></span><br><span class="line"><span class="comment">   * 13: invokevirtual #4 // 调用函数int addTwo(int, int)</span></span><br><span class="line"><span class="comment">   *                      // 由于是成员函数, 所以将this, 10, 11都作为参数传给addTwo</span></span><br><span class="line"><span class="comment">   * 16: pop              // 得到结果并弹出</span></span><br><span class="line"><span class="comment">   * 25: return</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-调用父类函数"><a href="#1-2-调用父类函数" class="headerlink" title="1.2 调用父类函数"></a>1.2 调用父类函数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SuperTest</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getInfo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_">SuperTest</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getInfo();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 0: aload_0          // 将this装入operand stack</span></span><br><span class="line"><span class="comment">   * 1: invokespecial #2 // 调用SuperTest.getinfo()</span></span><br><span class="line"><span class="comment">   *                     // 因为使用super指明是父类函数, 所以调用invokespecial</span></span><br><span class="line"><span class="comment">   * 4: ireturn</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-调用静态函数"><a href="#1-3-调用静态函数" class="headerlink" title="1.3 调用静态函数"></a>1.3 调用静态函数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">addTwoStatic</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> i+j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * static int addTwoStatic(int, int);</span></span><br><span class="line"><span class="comment"> * Code: stack=2, locals=2, args_size=2</span></span><br><span class="line"><span class="comment"> * 0: iload_0  // 直接从索引0开始从local variable array中取值</span></span><br><span class="line"><span class="comment"> * 1: iload_1</span></span><br><span class="line"><span class="comment"> * 2: iadd</span></span><br><span class="line"><span class="comment"> * 3: ireturn</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">  addTwoStatic(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 0: bipush 11</span></span><br><span class="line"><span class="comment"> * 2: bipush 12</span></span><br><span class="line"><span class="comment"> * 4: invokestatic #2 // 调用addTwoStatic(int, int)</span></span><br><span class="line"><span class="comment"> *                    // 由于是静态函数所以不需要传入this</span></span><br><span class="line"><span class="comment"> * 7: pop</span></span><br><span class="line"><span class="comment"> * 8: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>


<h2 id="2-Constant-Local-Variable和Control-Construct的使用"><a href="#2-Constant-Local-Variable和Control-Construct的使用" class="headerlink" title="2. Constant, Local Variable和Control Construct的使用"></a>2. Constant, Local Variable和Control Construct的使用</h2><h3 id="2-1-int类型变量的操作"><a href="#2-1-int类型变量的操作" class="headerlink" title="2.1 int类型变量的操作"></a>2.1 int类型变量的操作</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">spin</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// Loop body is empty</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 0: iconst_0      // 将constant 0放入operand stack中</span></span><br><span class="line"><span class="comment"> * 1: istore_0      // 将operand stack的顶端元素取出, 并赋值给local variable array中索引为0的元素(也就是i)</span></span><br><span class="line"><span class="comment"> * 2: iload_0       // 将local variable array中index为0的元素值(也就是i的值)放入operand stack中</span></span><br><span class="line"><span class="comment"> * 3: bipush 100    // 将要一个byte大小(因为100只用8位就能表示)的立即数放入operand stack</span></span><br><span class="line"><span class="comment"> * 5: if_icmpge 14  // 将operand stack顶部的两个值取出(例如v1和v2), 如果v1&gt;=v2, 跳至14</span></span><br><span class="line"><span class="comment"> * 8: iinc 0, 1     // 将local variable array中索引为0的值自加1(自加的值必须为signed int)</span></span><br><span class="line"><span class="comment"> * 11: goto 2       // 跳转到2</span></span><br><span class="line"><span class="comment"> * 14: return       // 返回void</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-short类型变量操作"><a href="#2-2-short类型变量操作" class="headerlink" title="2.2 short类型变量操作"></a>2.2 short类型变量操作</h3><p>由于operand stack和local variable的实现原因, Java指令支持int的store, load, add操作(也因为int使用最为频繁). 但对于其他Integer(byte, char, short)就没有相应的指令, 例如:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">sspin</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">short</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    ; <span class="comment">// Loop body is empty</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 0: iconst_0</span></span><br><span class="line"><span class="comment"> * 1: istore_0      // 使用int的方法存取</span></span><br><span class="line"><span class="comment"> * 2: iload_0</span></span><br><span class="line"><span class="comment"> * 3: bipush 100</span></span><br><span class="line"><span class="comment"> * 5: if_icmpge 16  // 使用int的比较方法来比较short类型</span></span><br><span class="line"><span class="comment"> * 8: iload_0</span></span><br><span class="line"><span class="comment"> * 9: iconst_1</span></span><br><span class="line"><span class="comment"> * 10: iadd</span></span><br><span class="line"><span class="comment"> * 11: i2s</span></span><br><span class="line"><span class="comment"> * 12: istore_0</span></span><br><span class="line"><span class="comment"> * 13: goto 2</span></span><br><span class="line"><span class="comment"> * 16: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-double类型变量操作"><a href="#2-3-double类型变量操作" class="headerlink" title="2.3 double类型变量操作"></a>2.3 double类型变量操作</h3><p>由于缺乏byte, char和short的操作指令, 所以用int的指令代替. 但这并没有什么不妥, 只不过int操作会导致值的截断<br>对于long和float类型来说, 有store和load指令, 但没有比较指令. 下面只以double为例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">dspin</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">double</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0.0</span>; i &lt; <span class="number">100.0</span>; i++) &#123;</span><br><span class="line">    ; <span class="comment">// Loop body is empty</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 0: dconst_0</span></span><br><span class="line"><span class="comment"> * 1: dstore_0</span></span><br><span class="line"><span class="comment"> * 2: dload_0</span></span><br><span class="line"><span class="comment"> * 3: ldc2_w #2 // double 100.0d</span></span><br><span class="line"><span class="comment"> * 6: dcmpg     // 从operand stack取出两个double值, v1,v2(v2在v1之上)</span></span><br><span class="line"><span class="comment"> *              // 如果v1&gt;v2, 将int 1放入operand stack</span></span><br><span class="line"><span class="comment"> *              // 如果v1==v2, 将int 0放入operand stack</span></span><br><span class="line"><span class="comment"> *              // 如果v1&lt;v2, 将int -1放入operand stack</span></span><br><span class="line"><span class="comment"> *              // 如果v1或v2其中一个为NaN, dcmpg将1放入operand stack, dcmpl将-1放入operand stack</span></span><br><span class="line"><span class="comment"> * 7: ifge 17   // 从operand stack顶部取出一个int值, 如果该值&gt;=0, 则跳转至17</span></span><br><span class="line"><span class="comment"> * 10: dload_0</span></span><br><span class="line"><span class="comment"> * 11: dconst_1</span></span><br><span class="line"><span class="comment"> * 12: dadd</span></span><br><span class="line"><span class="comment"> * 13: dstore_0</span></span><br><span class="line"><span class="comment"> * 14: goto 2</span></span><br><span class="line"><span class="comment"> * 17: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h2 id="3-Arithmetic"><a href="#3-Arithmetic" class="headerlink" title="3. Arithmetic"></a>3. Arithmetic</h2><p>JVM通常会在operand stack上做算术运算(iinc是个例外, 它直接针对local variable), 例如:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">align2grain</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> grain)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> ((i + grain-<span class="number">1</span>) &amp; ~(grain-<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iload_0   // 将local variable中第一个值(i)放入operand stack</span></span><br><span class="line"><span class="comment"> * 1: iload_1   // 将local variable中第二个值(grain)放入operand stack </span></span><br><span class="line"><span class="comment"> * 2: iadd      // 从operand stack中取出两个值, 相加(i+grain)并将结果放入operand stack</span></span><br><span class="line"><span class="comment"> * 3: iconst_1  // 将1放入operand stack</span></span><br><span class="line"><span class="comment"> * 4: isub      // 从operand stack中取出两个int值, 相减并将结果放入operand stack</span></span><br><span class="line"><span class="comment"> * 5: iload_1   // 将grain放入operand stack</span></span><br><span class="line"><span class="comment"> * 6: iconst_1  // 将1放入operand stack</span></span><br><span class="line"><span class="comment"> * 7: isub      // 取出两个int值相减并放回结果</span></span><br><span class="line"><span class="comment"> * 8: iconst_m1 // 放入-1(~x==-1^x)</span></span><br><span class="line"><span class="comment"> * 9: ixor      // 取出两个int, 异或操作后放入结果</span></span><br><span class="line"><span class="comment"> * 10: iand     // 取出两个int, and操作后放入结果</span></span><br><span class="line"><span class="comment"> * 11: ireturn</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>


<h2 id="4-Run-time-Constant-Pool"><a href="#4-Run-time-Constant-Pool" class="headerlink" title="4. Run-time Constant Pool"></a>4. Run-time Constant Pool</h2><h3 id="4-1-1-5"><a href="#4-1-1-5" class="headerlink" title="4.1 -1 ~ 5"></a>4.1 -1 ~ 5</h3><p>使用<code>iconst_&lt;i&gt;</code>指令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iconst_5 </span></span><br><span class="line"><span class="comment"> * 1: istore_1</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-128-127"><a href="#4-2-128-127" class="headerlink" title="4.2 -128 ~ 127"></a>4.2 -128 ~ 127</h3><p>使用<code>bipush</code>指令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: bipush    127</span></span><br><span class="line"><span class="comment"> * 2: istore_1</span></span><br><span class="line"><span class="comment"> * 3: bipush    -128</span></span><br><span class="line"><span class="comment"> * 5: istore_2</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-32768-32767"><a href="#4-3-32768-32767" class="headerlink" title="4.3 -32768 ~ 32767"></a>4.3 -32768 ~ 32767</h3><p>使用<strong>sipush</strong>指令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> -<span class="number">32768</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">32767</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 0: sipush -32768</span></span><br><span class="line"><span class="comment"> * 3: istore_1</span></span><br><span class="line"><span class="comment"> * 4: sipush 32767</span></span><br><span class="line"><span class="comment"> * 7: istore_2</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-2147483648-2147483647"><a href="#4-4-2147483648-2147483647" class="headerlink" title="4.4 -2147483648 ~ 2147483647"></a>4.4 -2147483648 ~ 2147483647</h3><p>使用<code>ldc</code>指令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> -<span class="number">32769</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">32768</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: ldc #2   // int -32769</span></span><br><span class="line"><span class="comment"> * 2: istore_1</span></span><br><span class="line"><span class="comment"> * 3: ldc #3   // int 32768</span></span><br><span class="line"><span class="comment"> * 5: istore_2</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-long-and-double"><a href="#4-5-long-and-double" class="headerlink" title="4.5 long and double"></a>4.5 long and double</h3><p>如果分配0或1, 则用<code>lconst_&lt;l&gt;</code>和<code>dconst_&lt;d&gt;</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">l1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> <span class="variable">l2</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">long</span> <span class="variable">l3</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: lconst_0</span></span><br><span class="line"><span class="comment"> * 1: lstore_1</span></span><br><span class="line"><span class="comment"> * 2: lconst_1</span></span><br><span class="line"><span class="comment"> * 3: lstore_3</span></span><br><span class="line"><span class="comment"> * 4: ldc2_w #2  // long 2l</span></span><br><span class="line"><span class="comment"> * 7: lstore 5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">d1</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line"><span class="type">double</span> <span class="variable">d2</span> <span class="operator">=</span> <span class="number">1.0</span>;</span><br><span class="line"><span class="type">double</span> <span class="variable">d3</span> <span class="operator">=</span> <span class="number">3.0</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 9: dconst_0</span></span><br><span class="line"><span class="comment"> * 10: dstore 7</span></span><br><span class="line"><span class="comment"> * 12: dconst_1</span></span><br><span class="line"><span class="comment"> * 13: dstore 9</span></span><br><span class="line"><span class="comment"> * 15: ldc2_w #4  // double 3.0d</span></span><br><span class="line"><span class="comment"> * 18: dstore 11</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>


<h2 id="5-条件控制"><a href="#5-条件控制" class="headerlink" title="5. 条件控制"></a>5. 条件控制</h2><h3 id="5-1-int"><a href="#5-1-int" class="headerlink" title="5.1 int"></a>5.1 int</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">whileInt</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; <span class="number">100</span>) &#123;</span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iconst_0      // 将0放入operand stack</span></span><br><span class="line"><span class="comment"> * 1: istore_0      // 将0从operand stack取出, 放入i</span></span><br><span class="line"><span class="comment"> * 2: iload_0       // 把i的值加载到operand stack中</span></span><br><span class="line"><span class="comment"> * 3: bipush 100    // 将100放入operand stack</span></span><br><span class="line"><span class="comment"> * 5: if_icmpge 14  // 取出并对比, i&gt;=100则跳转至14</span></span><br><span class="line"><span class="comment"> * 8: iinc 0, 1     // i自加1</span></span><br><span class="line"><span class="comment"> * 11: goto 2       // 跳转至2</span></span><br><span class="line"><span class="comment"> * 14: return</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-float-double"><a href="#5-2-float-double" class="headerlink" title="5.2 float&#x2F;double"></a>5.2 float&#x2F;double</h3><p>对于float和double类型来说, 有两种对比方式</p>
<ul>
<li>fcmpl和fcmpg</li>
<li>dcmpl和dcmpg</li>
</ul>
<p>当遇到NaN时会做出不同的行为, 以下以double为例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">lessThan100</span><span class="params">(<span class="type">double</span> d)</span> &#123; <span class="comment">// 输入d为Double.NaN</span></span><br><span class="line">  <span class="keyword">if</span> (d &lt; <span class="number">100.0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: dload_0</span></span><br><span class="line"><span class="comment"> * 1: ldc2_w #2   // double 100.0d</span></span><br><span class="line"><span class="comment"> * 4: dcmpg       // 由于v1和v2中有NaN, 将1装入operand stack中</span></span><br><span class="line"><span class="comment"> * 5: ifge 10     // 1&gt;0, 跳转到10</span></span><br><span class="line"><span class="comment"> * 8: iconst_1</span></span><br><span class="line"><span class="comment"> * 9: ireturn</span></span><br><span class="line"><span class="comment"> * 10: iconst_m1  // 将-1放入operand stack</span></span><br><span class="line"><span class="comment"> * 11: ireturn    // 返回operand stack</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-break"><a href="#5-3-break" class="headerlink" title="5.3 break"></a>5.3 break</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">breakTest</span><span class="params">(<span class="type">int</span> i)</span> &#123; <span class="comment">// i=10</span></span><br><span class="line">  <span class="keyword">while</span>(i&lt;<span class="number">10</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i&gt;<span class="number">5</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iload_0</span></span><br><span class="line"><span class="comment"> * 1: bipush 10</span></span><br><span class="line"><span class="comment"> * 3: if_icmpge 20</span></span><br><span class="line"><span class="comment"> * 6: iload_0</span></span><br><span class="line"><span class="comment"> * 7: iconst_5</span></span><br><span class="line"><span class="comment"> * 8: if_icmple 14</span></span><br><span class="line"><span class="comment"> * 11: goto 20</span></span><br><span class="line"><span class="comment"> * 14: iinc 0, 1</span></span><br><span class="line"><span class="comment"> * 17: goto 0</span></span><br><span class="line"><span class="comment"> * 20: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>


<h2 id="6-function-parameter"><a href="#6-function-parameter" class="headerlink" title="6. function parameter"></a>6. function parameter</h2><p>非成员函数将参数从0开始添加, 成员函数从1开始添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">addTwo</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> i+j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * static int addTwo(int, int);</span></span><br><span class="line"><span class="comment"> * flags: ACC_STATIC</span></span><br><span class="line"><span class="comment"> * Code:</span></span><br><span class="line"><span class="comment"> * stack=2, locals=2, args_size=2</span></span><br><span class="line"><span class="comment"> * 0: iload_0  // 从current frame的local variable array中获得索引为0的int值</span></span><br><span class="line"><span class="comment"> * 1: iload_1  // 从索引1上获得int值</span></span><br><span class="line"><span class="comment"> * 2: iadd   // 从operand stack中取出2个int相加</span></span><br><span class="line"><span class="comment"> * 3: ireturn  // 取出operand stack中所有值放入local variable array, 返回local variable array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">  addTwo(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * public static void main(java.lang.String[]);</span></span><br><span class="line"><span class="comment"> * flags: ACC_PUBLIC, ACC_STATIC</span></span><br><span class="line"><span class="comment"> * Code:</span></span><br><span class="line"><span class="comment"> * stack=2, locals=1, args_size=1</span></span><br><span class="line"><span class="comment"> * 0: iconst_1        // 将1放入operand stack</span></span><br><span class="line"><span class="comment"> * 1: iconst_2        // 将2放入operand stack</span></span><br><span class="line"><span class="comment"> * 2: invokestatic #2 // Method addTwo:(II)I</span></span><br><span class="line"><span class="comment"> * 5: pop             // 将operand stack顶部的值移出</span></span><br><span class="line"><span class="comment"> * 6: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>


<h2 id="7-Class-Object"><a href="#7-Class-Object" class="headerlink" title="7. Class Object"></a>7. Class Object</h2><h3 id="7-1-object-as-parameter"><a href="#7-1-object-as-parameter" class="headerlink" title="7.1 object as parameter"></a>7.1 object as parameter</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Test <span class="title function_">getTest</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">  <span class="keyword">return</span> processTest(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: new #2            // new Test(), 将objectref装入operand stack</span></span><br><span class="line"><span class="comment"> * 3: dup               // 复制objectref</span></span><br><span class="line"><span class="comment"> * 4: invokespecial #3  // 移出一个objectref, 调用初始化函数init() </span></span><br><span class="line"><span class="comment"> * 7: astore_0          // 移出一个objectref, 赋值给Local variable array索引为0的元素(t)</span></span><br><span class="line"><span class="comment"> * 8: aload_0           // 将local variable array索引为0的元素装入operand stack</span></span><br><span class="line"><span class="comment"> * 9: invokestatic #4   // 从operand stack中移出t, 并调用process Test</span></span><br><span class="line"><span class="comment"> * 12: areturn          // 从operand stack取出并返回objectref</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Test <span class="title function_">processTest</span><span class="params">(Test t)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (t != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: aload_0     // 将local variable array中索引为0的元素(参数t)装入operand stack</span></span><br><span class="line"><span class="comment"> * 1: ifnull 6    // 取出t, 并对比null. 如果t==null则跳转到6</span></span><br><span class="line"><span class="comment"> * 4: aload_0     // 将t装入operand stack</span></span><br><span class="line"><span class="comment"> * 5: areturn     // 从operand stack中取出t, 并返回</span></span><br><span class="line"><span class="comment"> * 6: aconst_null // 将null放入operand stack</span></span><br><span class="line"><span class="comment"> * 7: areturn     // 从operand stack中取出null, 并返回</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-call-member-function"><a href="#7-2-call-member-function" class="headerlink" title="7.2 call member function"></a>7.2 call member function</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 0: aload_0     // 将this装入operand stack</span></span><br><span class="line"><span class="comment">   * 1: iload_1     // 将常量1装入operand stack</span></span><br><span class="line"><span class="comment">   * 2: putfield #2 // 取出this和1, 通过this(objectref)找到堆上的t对象</span></span><br><span class="line"><span class="comment">   *                // 并通过#2(Fieldref)确定修改的值(i), 最后将1赋值给i</span></span><br><span class="line"><span class="comment">   * 5: return</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    t.set(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 0: new #3            // new Test, 将objectref放入operand stack</span></span><br><span class="line"><span class="comment">   * 3: dup               // 复制objectref</span></span><br><span class="line"><span class="comment">   * 4: invokespecial #4  // 取出一个objectref, 进行init初始化</span></span><br><span class="line"><span class="comment">   * 7: astore_1          // 取出一个objectref, 赋值给local variable array中index为1的元素(t)</span></span><br><span class="line"><span class="comment">   *                      // local variable array索引为0的元素是main函数的参数String[]</span></span><br><span class="line"><span class="comment">   * 8: aload_1           // 将t装入operand stack</span></span><br><span class="line"><span class="comment">   * 9: iconst_2          // 将常量2装入operand stack</span></span><br><span class="line"><span class="comment">   * 10: invokevirtual #5 // 取出t(this)和2, 调用成员函数set(int)</span></span><br><span class="line"><span class="comment">   * 13: return</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="8-Array"><a href="#8-Array" class="headerlink" title="8. Array"></a>8. Array</h2><h3 id="8-1-one-dimensional-array-of-primitive-type"><a href="#8-1-one-dimensional-array-of-primitive-type" class="headerlink" title="8.1 one-dimensional array of primitive type"></a>8.1 one-dimensional array of primitive type</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> buffer[];</span><br><span class="line">buffer = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line">buffer[<span class="number">10</span>] = value;</span><br><span class="line">value = buffer[<span class="number">11</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: bipush 100</span></span><br><span class="line"><span class="comment"> * 2: newarray int  // 取出100, 创建于一个int[100]数组</span></span><br><span class="line"><span class="comment"> *                  // 将arrayref装入operand stack</span></span><br><span class="line"><span class="comment"> * 4: astore_1      // 取出arrayref并赋值给buffer</span></span><br><span class="line"><span class="comment"> * 5: bipush 12</span></span><br><span class="line"><span class="comment"> * 7: istore_2      // 赋值value</span></span><br><span class="line"><span class="comment"> * 8: aload_1       // 装入buffer</span></span><br><span class="line"><span class="comment"> * 9: bipush 10</span></span><br><span class="line"><span class="comment"> * 11: iload_2      // 装入value</span></span><br><span class="line"><span class="comment"> * 12: iastore      // 将buffer, 10, value取出并赋值: buffer[10]=value</span></span><br><span class="line"><span class="comment"> * 13: aload_1      // 装入buffer</span></span><br><span class="line"><span class="comment"> * 14: bipush 11</span></span><br><span class="line"><span class="comment"> * 16: iaload       // 取出buffer和11, 装入buffer[11]的值</span></span><br><span class="line"><span class="comment"> * 17: istore_2     // 取出buffer[11], 赋值给value</span></span><br><span class="line"><span class="comment"> * 18: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-one-dimensional-array-with-of-reference"><a href="#8-2-one-dimensional-array-with-of-reference" class="headerlink" title="8.2 one-dimensional array with of reference"></a>8.2 one-dimensional array with of reference</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Test buffer[];</span><br><span class="line">buffer = <span class="keyword">new</span> <span class="title class_">Test</span>[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">Test</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">buffer[<span class="number">10</span>] = value;</span><br><span class="line">value = buffer[<span class="number">11</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: bipush 100</span></span><br><span class="line"><span class="comment"> * 2: anewarray #2      // 不一样的指令来创建引用数组</span></span><br><span class="line"><span class="comment"> * 5: astore_1</span></span><br><span class="line"><span class="comment"> * 6: new #2            // 创建Test对象</span></span><br><span class="line"><span class="comment"> * 9: dup</span></span><br><span class="line"><span class="comment"> * 10: invokespecial #3 // init()</span></span><br><span class="line"><span class="comment"> * 13: astore_2</span></span><br><span class="line"><span class="comment"> * 14: aload_1</span></span><br><span class="line"><span class="comment"> * 15: bipush 10</span></span><br><span class="line"><span class="comment"> * 17: aload_2</span></span><br><span class="line"><span class="comment"> * 18: aastore          // 不一样的数组赋值指令</span></span><br><span class="line"><span class="comment"> * 19: aload_1</span></span><br><span class="line"><span class="comment"> * 20: bipush 11</span></span><br><span class="line"><span class="comment"> * 22: aaload           // 不一样的数组取值指令</span></span><br><span class="line"><span class="comment"> * 23: astore_2</span></span><br><span class="line"><span class="comment"> * 24: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-multi-dimensional-array"><a href="#8-3-multi-dimensional-array" class="headerlink" title="8.3 multi-dimensional array"></a>8.3 multi-dimensional array</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> buffer[][][];</span><br><span class="line">buffer = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>][<span class="number">3</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">buffer[<span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>] = value;</span><br><span class="line">value = buffer[<span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iconst_2</span></span><br><span class="line"><span class="comment"> * 1: iconst_3</span></span><br><span class="line"><span class="comment"> * 2: iconst_4</span></span><br><span class="line"><span class="comment"> * 3: multianewarray #2,3 // 从operand stack中取出2,3,4作为数组长度</span></span><br><span class="line"><span class="comment"> *                        // #2作为array的符号引用(&quot;[[[I&quot;), 3作为数组的维度</span></span><br><span class="line"><span class="comment"> * 7: astore_1    // 赋值给buffer</span></span><br><span class="line"><span class="comment"> * 8: bipush 10</span></span><br><span class="line"><span class="comment"> * 10: istore_2   // 赋值给value</span></span><br><span class="line"><span class="comment"> * 11: aload_1</span></span><br><span class="line"><span class="comment"> * 12: iconst_1</span></span><br><span class="line"><span class="comment"> * 13: aaload     // 获得buffer[1]</span></span><br><span class="line"><span class="comment"> * 14: iconst_1</span></span><br><span class="line"><span class="comment"> * 15: aaload     // 获得buffer[1][1]</span></span><br><span class="line"><span class="comment"> * 16: iconst_1</span></span><br><span class="line"><span class="comment"> * 17: iload_2</span></span><br><span class="line"><span class="comment"> * 18: iastore    // 将value存入buffer[1][1][1]中</span></span><br><span class="line"><span class="comment"> * 19: aload_1    // 获得buffer</span></span><br><span class="line"><span class="comment"> * 20: iconst_1</span></span><br><span class="line"><span class="comment"> * 21: aaload     // 获得buffer[1]</span></span><br><span class="line"><span class="comment"> * 22: iconst_1</span></span><br><span class="line"><span class="comment"> * 23: aaload     // 获得buffer[1][1]</span></span><br><span class="line"><span class="comment"> * 24: iconst_1</span></span><br><span class="line"><span class="comment"> * 25: iaload     // 获得buffer[1][1][1]</span></span><br><span class="line"><span class="comment"> * 26: istore_2   // 将buffer[1][1][1]赋值给value</span></span><br><span class="line"><span class="comment"> * 27: return</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h2 id="9-switch"><a href="#9-switch" class="headerlink" title="9. switch"></a>9. switch</h2><p>Java有两条指令来处理int类型的switch: <code>tableswitch</code>和<code>lookupswitch</code>. 如果数据类型为byte, char或short, 则先将类型提升至int然后再做处理. tableswitch针对连续case值, lookupswitch针对不连续case值:</p>
<h3 id="9-1-table"><a href="#9-1-table" class="headerlink" title="9.1 table"></a>9.1 table</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">chooseNear</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iload_0</span></span><br><span class="line"><span class="comment"> * 1: tableswitch &#123; // 0 to 2</span></span><br><span class="line"><span class="comment"> *      0: 28       // 跳转至28</span></span><br><span class="line"><span class="comment"> *      1: 30       // 跳转至30</span></span><br><span class="line"><span class="comment"> *      2: 32       // 跳转至32</span></span><br><span class="line"><span class="comment"> *      default: 34</span></span><br><span class="line"><span class="comment"> *    &#125;</span></span><br><span class="line"><span class="comment"> * 28: iconst_0</span></span><br><span class="line"><span class="comment"> * 29: ireturn</span></span><br><span class="line"><span class="comment"> * 30: iconst_1</span></span><br><span class="line"><span class="comment"> * 31: ireturn</span></span><br><span class="line"><span class="comment"> * 32: iconst_2</span></span><br><span class="line"><span class="comment"> * 33: ireturn</span></span><br><span class="line"><span class="comment"> * 34: iconst_m1</span></span><br><span class="line"><span class="comment"> * 35: ireturn</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="9-2-lookupswitch"><a href="#9-2-lookupswitch" class="headerlink" title="9.2 lookupswitch"></a>9.2 lookupswitch</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">chooseFar</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">    <span class="keyword">case</span> -<span class="number">10</span>: <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>: <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">20</span>: <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0: iload_0</span></span><br><span class="line"><span class="comment"> * 1: lookupswitch &#123; // 3</span></span><br><span class="line"><span class="comment"> *      -10: 36</span></span><br><span class="line"><span class="comment"> *      10: 38</span></span><br><span class="line"><span class="comment"> *      20: 40</span></span><br><span class="line"><span class="comment"> *      default: 42</span></span><br><span class="line"><span class="comment"> *    &#125;</span></span><br><span class="line"><span class="comment"> * 36: iconst_0</span></span><br><span class="line"><span class="comment"> * 37: ireturn</span></span><br><span class="line"><span class="comment"> * 38: iconst_1</span></span><br><span class="line"><span class="comment"> * 39: ireturn</span></span><br><span class="line"><span class="comment"> * 40: iconst_2</span></span><br><span class="line"><span class="comment"> * 41: ireturn</span></span><br><span class="line"><span class="comment"> * 42: iconst_m1</span></span><br><span class="line"><span class="comment"> * 43: ireturn</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>


<h2 id="10-Member-Variable"><a href="#10-Member-Variable" class="headerlink" title="10. Member Variable"></a>10. Member Variable</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="title function_">nextIndex</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> index++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 0: aload_0     // 装入this</span></span><br><span class="line"><span class="comment"> 1: dup</span></span><br><span class="line"><span class="comment"> 2: getfield #2   // 通过this(objectref)和#2(Fieldref)获得index的值, 并装入operand stack</span></span><br><span class="line"><span class="comment"> 5: dup2_x1     // 复制index的值</span></span><br><span class="line"><span class="comment"> 6: lconst_1</span></span><br><span class="line"><span class="comment"> 7: ladd      // 取出index和1, 装入求和后的数值(1)</span></span><br><span class="line"><span class="comment"> 8: putfield #2   // 通过this, #2将和数(1)放回index</span></span><br><span class="line"><span class="comment">11: lreturn     // 返回index未改变的值(0)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


<h2 id="11-Declaring-Member-Variable"><a href="#11-Declaring-Member-Variable" class="headerlink" title="11. Declaring Member Variable"></a>11. Declaring Member Variable</h2><h3 id="11-1-throw"><a href="#11-1-throw" class="headerlink" title="11.1 throw"></a>11.1 throw</h3><p>当用athrow时, 则在exception_table中寻找这个objectref的handler, 如果找到对应的handler, pc重置到handler的位置, 并将frame的operand stack清空, objectref装入operand stack中.<br>如果没有handler, 则将当前frame弹出, 并将objectref抛给该frame的调用者.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">dosomething</span><span class="params">()</span> <span class="keyword">throws</span> ArithmeticException &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span><span class="number">0</span>, b = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(a == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ArithmeticException</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> b/a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 0: iconst_0</span></span><br><span class="line"><span class="comment"> 1: istore_0      // a=0</span></span><br><span class="line"><span class="comment"> 2: iconst_1</span></span><br><span class="line"><span class="comment"> 3: istore_1      // b=0</span></span><br><span class="line"><span class="comment"> 4: iload_0</span></span><br><span class="line"><span class="comment"> 5: ifne 16       // 如果a!=0, 跳转到16</span></span><br><span class="line"><span class="comment"> 8: new #2        // 创建一个ArithmeticException对象, objectref入栈</span></span><br><span class="line"><span class="comment">11: dup</span></span><br><span class="line"><span class="comment">12: invokespecial #3  // 调用ArithmeticException的初始化函数&lt;init&gt;</span></span><br><span class="line"><span class="comment">15: athrow        // 抛出一个objectref</span></span><br><span class="line"><span class="comment">16: iload_1</span></span><br><span class="line"><span class="comment">17: iload_0</span></span><br><span class="line"><span class="comment">18: idiv</span></span><br><span class="line"><span class="comment">19: ireturn</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="11-2-catch"><a href="#11-2-catch" class="headerlink" title="11.2 catch"></a>11.2 catch</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">dosomething</span><span class="params">()</span> <span class="keyword">throws</span> ArithmeticException &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;an error&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 0: iconst_1        // 装入1</span></span><br><span class="line"><span class="comment"> 1: iconst_0        // 装入0</span></span><br><span class="line"><span class="comment"> 2: idiv</span></span><br><span class="line"><span class="comment"> 3: istore_0        // 存入a</span></span><br><span class="line"><span class="comment"> 4: goto 16</span></span><br><span class="line"><span class="comment"> 7: astore_0        // 取出objectref</span></span><br><span class="line"><span class="comment"> 8: getstatic #3      // 获得PrintStream</span></span><br><span class="line"><span class="comment">11: ldc #4          // &quot;an error&quot;</span></span><br><span class="line"><span class="comment">13: invokevirtual #5    // 调用println</span></span><br><span class="line"><span class="comment">16: return</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="11-3-finally"><a href="#11-3-finally" class="headerlink" title="11.3 finally"></a>11.3 finally</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">dosomething</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    b = a + b;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (RuntimeException e1) &#123;</span><br><span class="line">    b = a - b;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">    b = a * b;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    a = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 0: iconst_1</span></span><br><span class="line"><span class="comment"> 1: istore_0    // a=1</span></span><br><span class="line"><span class="comment"> 2: iconst_3</span></span><br><span class="line"><span class="comment"> 3: istore_1    // b=3</span></span><br><span class="line"><span class="comment"> 4: iload_0</span></span><br><span class="line"><span class="comment"> 5: iload_1</span></span><br><span class="line"><span class="comment"> 6: iadd      // a+b</span></span><br><span class="line"><span class="comment"> 7: istore_1    // b=a+b</span></span><br><span class="line"><span class="comment"> 8: iconst_0    // finally</span></span><br><span class="line"><span class="comment"> 9: istore_0    </span></span><br><span class="line"><span class="comment">10: goto 38</span></span><br><span class="line"><span class="comment">13: astore_2    // 异常对象引用在operand stack栈顶, 放入local variable</span></span><br><span class="line"><span class="comment">14: iload_0</span></span><br><span class="line"><span class="comment">15: iload_1</span></span><br><span class="line"><span class="comment">16: isub      // a-b</span></span><br><span class="line"><span class="comment">17: istore_1    </span></span><br><span class="line"><span class="comment">18: iconst_0    // finally</span></span><br><span class="line"><span class="comment">19: istore_0</span></span><br><span class="line"><span class="comment">20: goto 38</span></span><br><span class="line"><span class="comment">23: astore_2    // 异常对象引用在operand stack栈顶, 放入local variable</span></span><br><span class="line"><span class="comment">24: iload_0</span></span><br><span class="line"><span class="comment">25: iload_1</span></span><br><span class="line"><span class="comment">26: imul      // a*b</span></span><br><span class="line"><span class="comment">27: istore_1</span></span><br><span class="line"><span class="comment">28: iconst_0    // finally</span></span><br><span class="line"><span class="comment">29: istore_0</span></span><br><span class="line"><span class="comment">30: goto 38</span></span><br><span class="line"><span class="comment">33: astore_3    // 异常对象引用在operand stack栈顶, 放入local variable</span></span><br><span class="line"><span class="comment">34: iconst_0    // finally</span></span><br><span class="line"><span class="comment">35: istore_0</span></span><br><span class="line"><span class="comment">36: aload_3</span></span><br><span class="line"><span class="comment">37: athrow      // 抛出异常</span></span><br><span class="line"><span class="comment">38: return</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

    </div>

    <footer class="post-footer">
      
      <div class="post-tags">
        
          <a href="/tags/Programming-Language/">Programming Language</a>
        
      </div>
      

      
      
  <nav class="post-nav">
    
      <a class="prev" href="/p/bd61.html">
        <i class="icon-left"></i>
        <span class="prev-text nav-default">HashMap</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/p/a4a2.html">
        <span class="next-text nav-default">JVM (2)</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="icon-right"></i>
      </a>
    
  </nav>

      
    </footer>
  </article>

  </div>
  
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    showProcessingMessages: true,
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: false,
        skipTags: ["script","noscript","style","textarea"]
    },
    TeX: {
        Macros:{
            Arr: ["\\{ #1 \\}", 1],
            fi: "{f\\,\\!_i}",
            SS: ["{#1\\:\\!_#2}",2],
            SUBx: ["{\\:\\!_#1}",1],
            EXPx: ["{\\;\\!^#1}",1],
            Ss: ["{#1\\,\\!_#2}",2],
            subx: ["{\\,\\!_#1}",1]
        }
    }
});
</script>


      </div>
    </div>

    
<script type="text/javascript">
  var disqus_shortname = 'zaf1ro';
  var disqus_identifier = 'p/94a0.html';
  var disqus_title = "JVM (3)";

  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.6.0.min.js"></script>
  

  

    
    <script type="text/javascript">
(function(){"use strict";var Theme={};Theme.backToTop={register:function(){var $backToTop=$('#back-to-top');$(window).scroll(function(){if($(window).scrollTop()>100){$backToTop.fadeIn(1000)}else{$backToTop.fadeOut(1000)}});$backToTop.click(function(){$('body').animate({scrollTop:0})})}};Theme.fancybox={register:function(){if($.fancybox){$('.post').each(function(){$(this).find('img').each(function(){$(this).wrap('<a class="fancybox" href="'+this.src+'" title="'+this.alt+'"></a>')})});$('.fancybox').fancybox({openEffect:'elastic',closeEffect:'elastic'})}}};this.Theme=Theme}.call(this));
</script>

<script type="text/javascript">
$(document).ready(function(){if(themeConfig.fancybox.enable){Theme.fancybox.register()}Theme.backToTop.register()});
</script>
    
<script type="text/javascript">
var themeConfig = {
  fancybox: {
    enable: false
  },
};
</script>

    <script>
    $('table').wrap('<div style="overflow-x: auto;"></div>');
</script>
    
    <script>
$(document).ready(function () {
    $('#sidebarCollapse').on('click', function(){
        $('#sidebar').toggleClass('active');
    });

    $('#toc ol li a').on('click', function(){
        $('#sidebar').toggleClass('active');
    });
});
</script>
  </body>
</html>
