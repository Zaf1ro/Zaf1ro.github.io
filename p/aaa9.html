<!DOCTYPE html>
<html lang="zh">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">



  <meta name="description" content="DDD Overview"/>




  <meta name="keywords" content="Microservices," />


<meta name="google-site-verification" content="qy4gf0StWj627u-7aIP3WDCLBi3jPYXhm57UC7TUcok" />
<meta name="baidu-site-verification" content="XJoPG7ad2Z" />

<link rel="alternate" hreflang="x-default" href="https://zaf1ro.github.io/p/aaa9.html" />
<link rel="alternate" hreflang="zh" href="https://zaf1ro.github.io/p/aaa9.html" />




  <link rel="alternate" href="/default" title="Zaf1ro" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.jpeg?v=1.1" />



<link rel="canonical" href="https://zaf1ro.github.io/p/aaa9.html"/>


<meta name="description" content="1. Definition of DDDDDD(Domain-driven design)作为一种概念, 主张将软件代码中的结构和语言(class name, class method, class variable)与business domain(业务领域)相结合. 举个例子, 若一个应用用于处理贷款, 那么它可能包含名为LoadApplication和Customer的class, 还有名为">
<meta property="og:type" content="article">
<meta property="og:title" content="DDD Overview">
<meta property="og:url" content="https://zaf1ro.github.io/p/aaa9.html">
<meta property="og:site_name" content="Zaf1ro">
<meta property="og:description" content="1. Definition of DDDDDD(Domain-driven design)作为一种概念, 主张将软件代码中的结构和语言(class name, class method, class variable)与business domain(业务领域)相结合. 举个例子, 若一个应用用于处理贷款, 那么它可能包含名为LoadApplication和Customer的class, 还有名为">
<meta property="og:locale">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-1.jpg">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-2.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-3.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-7.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-4.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-5.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-6.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-10.png">
<meta property="article:published_time" content="2021-01-02T14:10:18.000Z">
<meta property="article:modified_time" content="2024-08-20T16:43:04.036Z">
<meta property="article:tag" content="Microservices">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zaf1ro.github.io/images/microservice/ddd-overview-1.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />




    <title>
DDD Overview - Zaf1ro
</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body>
  <nav id="sidebar" class="active on-post">
    <div id="third">
      <div id="sidebar-title">
        <h1 id="sidebar-title-text">
            <a href="/." class="logo">Home</a>
        </h1>
      </div>
      <div id="google-search">
  <script async src="https://cse.google.com/cse.js?cx=009060789867951546370:v3hkcobeuh9"></script>
  <div class="gcse-search"></div>
</div>
      
  <div id="toc">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Definition-of-DDD"><span class="toc-text">1. Definition of DDD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Strategic-Design"><span class="toc-text">2. Strategic Design</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Ubiquitous-Language"><span class="toc-text">3. Ubiquitous Language</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Tactical-Design"><span class="toc-text">4. Tactical Design</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Anemic-pattern"><span class="toc-text">5. Anemic pattern</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pro-of-DDD"><span class="toc-text">Pro of DDD</span></a></li></ol>
  </div>

    </div>
  </nav>

    <div id="page">
      <header id="masthead"><div class="site-header-inner">
  
  <button class="nav-mobile-button on-post" id="sidebarCollapse">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"/></svg>
  </button>
  
  


  <nav id="nav-top">
    
      
      <ul id="menu-top" class="nav-top-items on-post">
      
        
          <li class="menu-item">
            <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Zaf1ro">
              
              
                Github
              
            </a>
          </li>
        
      </ul>
    
  </nav>
</div>

      </header>
      <div id="content">
        
  <div class="primary">
    
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          DDD Overview
        
      </h1>
      <time class="post-time">
          01/02/21
      </time>
    </header>

    <div class="post-content">
      <h2 id="1-Definition-of-DDD"><a href="#1-Definition-of-DDD" class="headerlink" title="1. Definition of DDD"></a>1. Definition of DDD</h2><p>DDD(Domain-driven design)作为一种概念, 主张将软件代码中的结构和语言(class name, class method, class variable)与business domain(业务领域)相结合. 举个例子, 若一个应用用于处理贷款, 那么它可能包含名为<strong>LoadApplication</strong>和<strong>Customer</strong>的class, 还有名为<strong>AcceptOffer</strong>和<strong>Withdraw</strong>的method. DDD的设计基于以下几个目标:</p>
<ul>
<li>将项目中的重点放在core domain和domain logic</li>
<li>根据domain model进行复杂设计</li>
<li>让技术专家和domain expert开始创造性工作, 以迭代方式提炼出一个概念上的model, 并借此解决特定领域问题</li>
</ul>
<p>以下是DDD pattern的全貌:<br><img src="/images/microservice/ddd-overview-1.jpg" alt="Ovew of DDD"></p>
<p>DDD主要分为两部分:</p>
<ul>
<li>Strategic Design(战略设计): 将domain拆分成多个subdomain, 目标是为了定义Bounded Context, Ubiquitous Language和Context Maps.</li>
<li>Tactical Design(战术设计): 其中包含很多用于构建domain model的技术资源, 例如: entity, value object, aggregate, service, repository, factory, event, module. 这些技术被运用在单个Bounded Context中.</li>
</ul>
<h2 id="2-Strategic-Design"><a href="#2-Strategic-Design" class="headerlink" title="2. Strategic Design"></a>2. Strategic Design</h2><p>DDD的的strategic design目的在于协助开发者捕获并获得e<strong>Domain Knowledgee</strong>(领域知识), 并将其拆分成适当的大小以便后续分析处理. 整个strategic design可分为以下几点:</p>
<ul>
<li>与domain expert沟通, 捕获domain knowledge并构建<strong>Ubiquitous Language</strong>(通用语言)</li>
<li>依照所理解的<strong>Problem Space</strong>(问题域)以及<strong>Solution Space</strong>(解决方案域)来建立<strong>Domain</strong>(领域)<ul>
<li>Problem Space: 代表domain关注的问题, 可拆分为多个Subdomain</li>
<li>Solution Space: 代表doamin的解决方案, 可开发多个domain model来解决问题, domain model需要被隔离在Bounded Context中保证Model与Ubiquitous Language一致</li>
</ul>
</li>
<li>Subdomain根据优先级分为多个类型:<ul>
<li>Core Doamin</li>
<li>Supporting Subdomain</li>
<li>Generic Subdomain</li>
</ul>
</li>
<li>遵循Ubiquitous Language将Solution Space分成一个个语义边界, 称为<strong>Bounded Context</strong>(限界上下文, 简称BC)</li>
<li>使用<strong>Context Mapping</strong>(上下文地图)定义多个BC之间的关系</li>
</ul>
<p>BC(Bounded Context)作为概念上的边界, 适用于domain model. 每个BC都有自己的Ubiquitous Language, 用于组内开发者沟通和展示软件模块, 如下图:<br><img src="/images/microservice/ddd-overview-2.png" alt="A diagram illustrating a Bounded Context and relevant Ubiquitous Language"></p>
<p>当我们使用Strategic Design时, 会发现<strong>Context Mapping</strong>是一种很好的模式, 以便清晰地辨别各个BC之间的关系:<br><img src="/images/microservice/ddd-overview-3.png" alt="Context Maps show the relationships among Bounded Contexts"></p>
<h2 id="3-Ubiquitous-Language"><a href="#3-Ubiquitous-Language" class="headerlink" title="3. Ubiquitous Language"></a>3. Ubiquitous Language</h2><p>由于现代软件开发的复杂度越来越高, 没有一个开发者可以掌握团队中所有业务细节, 甚至连domain expert都可能有所疏漏. 为了在开发过程中, 我们需要对业务中的知识建立共识, 建立Ubiquitous Language来减少沟通和理解成本. 简单说, Ubiquitous Language可以作为一套domain内描述业务概念的用词表, 可用于团队沟通, 文档, 和代码中.<br>例如: 当我们描述使用服务的&quot;客户&quot;时, 不同的开发者面对不同的业务, 可能有以下几种称呼:</p>
<ul>
<li>user</li>
<li>buyer</li>
<li>consumer</li>
<li>client</li>
<li>....</li>
</ul>
<p>如果放任团队中的每个人使用不同的名称, 那么无论是沟通, 还是代码实现中, 都会出现分歧. 无论对于domain expert和开发团队的沟通, 不同开发者间的沟通, 还是后续开发者的接手, 都是一种障碍. Domain expert和技术团队应建立一种Ubiquitous Language, 让所有业务知识都有统一且明确的名称和涵义, 如下图:<br><img src="/images/microservice/ddd-overview-7.png" alt="Glossary - Ubiquitous Language"></p>
<h2 id="4-Tactical-Design"><a href="#4-Tactical-Design" class="headerlink" title="4. Tactical Design"></a>4. Tactical Design</h2><p>Tactical design可以帮助开发者运用一些成熟的design pattern, 将strategic design的成果以代码形式实现, 以下是用到的一些design pattern:</p>
<ul>
<li>Entity(实体): 能被辨别出来的物体, 自身带有id. Entity的状态会在其生命周期中不断变化.</li>
<li>Value Object(值对象): 无identity概念, 状态不可变的对象, 用于描述某个事物的特征.</li>
<li>Aggregate(聚合): 多个对象组成的集合, 包含entity和value object(其中一个entity作为aggregate root, 所有与aggregate外部的交流都由aggregate root负责). 一个aggregate即一个transaction的边界.</li>
</ul>
<p>上述三个负责domain的业务逻辑, 因此也被称为domain object(领域对象).</p>
<ul>
<li><p>Repository(仓库): 用于持久化domain object, 可以转接ORM或File system. 通常一个aggregate对应一个repository. 以下是一个示例图:<br><img src="/images/microservice/ddd-overview-4.png" alt="Two Aggregate types with their own transactional consistency boundaries"></p>
</li>
<li><p>Factory(工厂): 与<strong>Design Patterns: Elements of Reusable Object-Oriented Software</strong>一书中的Factory pattern相同, 在DDD中用于处理aggregate生成的复杂场景.</p>
</li>
<li><p>Domain event(领域): 表示domain中发生的事件, 用于多个aggregate之间的沟通. 当aggregate做出某些操作后, 可以发布domain event, 如下图:</p>
</li>
<li><p>Domain service(领域服务): 当某个business logic无法被安排到任何一个domain object时, 会由domain service负责, 如下图:<br><img src="/images/microservice/ddd-overview-5.png" alt="Domain Services carry out domain-specific operations, which may involve multiple domain objects"></p>
</li>
<li><p>Application Service(应用服务): 负责处理请求, 调用domain object和domain service以处理业务逻辑<br><img src="/images/microservice/ddd-overview-6.png" alt="Domain Events can be published by Aggregates"></p>
</li>
</ul>
<p>以下是DDD的学习路线图:<br><img src="/images/microservice/ddd-overview-10.png" alt="Roadmap of Domain-Driven Design"></p>
<h2 id="5-Anemic-pattern"><a href="#5-Anemic-pattern" class="headerlink" title="5. Anemic pattern"></a>5. Anemic pattern</h2><p>该anti-pattern设计下的class有以下特征:</p>
<ul>
<li>乍看上去像是一个真实存在的物品抽象, 其中包含一些object(对象), 对象名称是有意义的, 这些对象也具有紧密关系</li>
<li>对象几乎没有什么行为, 只有一些简单的getter和setter</li>
</ul>
<p>其中一些ORM工具如Hibernate. Entity Framework更是助长了anemic pattern的扩散. 当使用anemic model时, 看似是面向对象编程(使用到class, 且class中有紧密相关的数据与操作函数), 但实际上只是对数据进行简单的封装, 本质上仍然是<strong>面向过程</strong>. 这种模式设计下的class对象功能贫乏, 就像贫血一样, 因此称为anemic pattern. 当上层调用这种pattern的对象时, 很容易写出transaction script(事务脚本), 导致开发效率低下, 维护成本巨大, 如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">customer = <span class="keyword">new</span> <span class="title class_">Customer</span>(<span class="string">&#x27;Bill&#x27;</span>);</span><br><span class="line">order = Order.create(customer, <span class="string">&#x27;Coffee&#x27;</span>);</span><br><span class="line">staff = <span class="keyword">new</span> <span class="title class_">Staff</span>(<span class="number">9527</span>);</span><br><span class="line">cashier = <span class="keyword">new</span> <span class="title class_">Cashier</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结账</span></span><br><span class="line">order.setStaff(staff);</span><br><span class="line">staff.setCashier(cashier);</span><br><span class="line">staff.setOrders(order);</span><br><span class="line">cashier.addOrder(order);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泡咖啡</span></span><br><span class="line">cup = <span class="keyword">new</span> <span class="title class_">Cup</span>();</span><br><span class="line">staff.setCup();</span><br><span class="line">cup.setFilterCone(<span class="keyword">new</span> <span class="title class_">FilterCone</span>());</span><br><span class="line">cup.setCoffeeGround(<span class="keyword">new</span> <span class="title class_">Coffee</span>());</span><br><span class="line">staff.brew(cup);</span><br><span class="line">staff.wait();</span><br><span class="line">staff.setFilterCone(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 送餐</span></span><br><span class="line">staff.setCoffeeTo(customer);</span><br><span class="line">customer.setCoffee(order);</span><br></pre></td></tr></table></figure>
<p>通过DDD设计后, 与domain expert沟通并形成Ubiquitous Language后, 可让代码修改如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">barista = <span class="keyword">new</span> <span class="title class_">Barista</span>(<span class="number">9527</span>);</span><br><span class="line">customer = <span class="keyword">new</span> <span class="title class_">Customer</span>(<span class="string">&#x27;Bill&#x27;</span>);</span><br><span class="line">order = customer.placeOrder(order);</span><br><span class="line"></span><br><span class="line">barista.processPayment(order);</span><br><span class="line">barista.make(order);</span><br><span class="line">barista.serveOrderTo(order, customer);</span><br></pre></td></tr></table></figure>

<h2 id="Pro-of-DDD"><a href="#Pro-of-DDD" class="headerlink" title="Pro of DDD"></a>Pro of DDD</h2><p>以下是DDD的优点:</p>
<ul>
<li>促进跨团队沟通, 深入理解领域知识</li>
<li>专注于核心业务上</li>
<li>保证业务逻辑不会因外部依赖的更改而影响</li>
<li>更好的模块化</li>
<li>更容易测试</li>
<li>更容易迭代和维护</li>
</ul>
<p>以下是DDD不适合的项目类型:</p>
<ul>
<li>项目中没有domain expert</li>
<li>项目没有多余的沟通时间和学习成本</li>
<li>项目的业务逻辑较为简单</li>
<li>项目的业务逻辑几乎不发生变化</li>
</ul>

    </div>

    <footer class="post-footer">
      
      <div class="post-tags">
        
          <a href="/tags/Microservices/">Microservices</a>
        
      </div>
      

      
      
  <nav class="post-nav">
    
      <a class="prev" href="/p/5a33.html">
        <i class="icon-left"></i>
        <span class="prev-text nav-default">Domain, Subdomain, and Bounded Context</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/p/a6fe.html">
        <span class="next-text nav-default">Why Use DDD</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="icon-right"></i>
      </a>
    
  </nav>

      
    </footer>
  </article>

  </div>
  
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    showProcessingMessages: true,
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: false,
        skipTags: ["script","noscript","style","textarea"]
    },
    TeX: {
        Macros:{
            Arr: ["\\{ #1 \\}", 1],
            fi: "{f\\,\\!_i}",
            SS: ["{#1\\:\\!_#2}",2],
            SUBx: ["{\\:\\!_#1}",1],
            EXPx: ["{\\;\\!^#1}",1],
            Ss: ["{#1\\,\\!_#2}",2],
            subx: ["{\\,\\!_#1}",1]
        }
    }
});
</script>


      </div>
    </div>

    
<script type="text/javascript">
  var disqus_shortname = 'zaf1ro';
  var disqus_identifier = 'p/aaa9.html';
  var disqus_title = "DDD Overview";

  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.6.0.min.js"></script>
  

  

    
    <script type="text/javascript">
(function(){"use strict";var Theme={};Theme.backToTop={register:function(){var $backToTop=$('#back-to-top');$(window).scroll(function(){if($(window).scrollTop()>100){$backToTop.fadeIn(1000)}else{$backToTop.fadeOut(1000)}});$backToTop.click(function(){$('body').animate({scrollTop:0})})}};Theme.fancybox={register:function(){if($.fancybox){$('.post').each(function(){$(this).find('img').each(function(){$(this).wrap('<a class="fancybox" href="'+this.src+'" title="'+this.alt+'"></a>')})});$('.fancybox').fancybox({openEffect:'elastic',closeEffect:'elastic'})}}};this.Theme=Theme}.call(this));
</script>

<script type="text/javascript">
$(document).ready(function(){if(themeConfig.fancybox.enable){Theme.fancybox.register()}Theme.backToTop.register()});
</script>
    
<script type="text/javascript">
var themeConfig = {
  fancybox: {
    enable: false
  },
};
</script>

    <script>
    $('table').wrap('<div style="overflow-x: auto;"></div>');
</script>
    
    <script>
$(document).ready(function () {
    $('#sidebarCollapse').on('click', function(){
        $('#sidebar').toggleClass('active');
    });

    $('#toc ol li a').on('click', function(){
        $('#sidebar').toggleClass('active');
    });
});
</script>
  </body>
</html>
