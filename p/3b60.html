<!DOCTYPE html>
<html lang="zh">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">



  <meta name="description" content="VLAN"/>




  <meta name="keywords" content="Network," />


<meta name="google-site-verification" content="qy4gf0StWj627u-7aIP3WDCLBi3jPYXhm57UC7TUcok" />
<meta name="baidu-site-verification" content="XJoPG7ad2Z" />

<link rel="alternate" hreflang="x-default" href="https://zaf1ro.github.io/p/3b60.html" />
<link rel="alternate" hreflang="zh" href="https://zaf1ro.github.io/p/3b60.html" />




  <link rel="alternate" href="/default" title="Zaf1ro" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.jpeg?v=1.1" />



<link rel="canonical" href="https://zaf1ro.github.io/p/3b60.html"/>


<meta name="description" content="1. 交换设备1.1 Hub 二层设备, 只能连接同一网段的设备 带宽平分 同一时间两个设备发送给Hub的信号会冲突 只能应用于少量的主机 某个设备发出的信息会被Hub连接的其他所有设备收到   Host A发送给Host B信息, Host C和D也能收到信息 1.2 Bridge 具有二层的过滤功能(根据MAC信息) 可以连接不同的网段 由于是软件来过滤和转发信息, 所以不能全速转发 具有少量">
<meta property="og:type" content="article">
<meta property="og:title" content="VLAN">
<meta property="og:url" content="https://zaf1ro.github.io/p/3b60.html">
<meta property="og:site_name" content="Zaf1ro">
<meta property="og:description" content="1. 交换设备1.1 Hub 二层设备, 只能连接同一网段的设备 带宽平分 同一时间两个设备发送给Hub的信号会冲突 只能应用于少量的主机 某个设备发出的信息会被Hub连接的其他所有设备收到   Host A发送给Host B信息, Host C和D也能收到信息 1.2 Bridge 具有二层的过滤功能(根据MAC信息) 可以连接不同的网段 由于是软件来过滤和转发信息, 所以不能全速转发 具有少量">
<meta property="og:locale">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/1.1_1.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/1.2_1.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/1.3_1.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/2.1_1.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/2.5_1.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/2.5_2.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/2.5_3.png">
<meta property="og:image" content="https://zaf1ro.github.io/images/Network/VLAN/3.1_1.png">
<meta property="article:published_time" content="2017-06-15T18:45:21.000Z">
<meta property="article:modified_time" content="2024-08-20T16:43:04.045Z">
<meta property="article:tag" content="Network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zaf1ro.github.io/images/Network/VLAN/1.1_1.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />




    <title>
VLAN - Zaf1ro
</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body>
  <nav id="sidebar" class="active on-post">
    <div id="third">
      <div id="sidebar-title">
        <h1 id="sidebar-title-text">
            <a href="/." class="logo">Home</a>
        </h1>
      </div>
      <div id="google-search">
  <script async src="https://cse.google.com/cse.js?cx=009060789867951546370:v3hkcobeuh9"></script>
  <div class="gcse-search"></div>
</div>
      
  <div id="toc">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BA%A4%E6%8D%A2%E8%AE%BE%E5%A4%87"><span class="toc-text">1. 交换设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Hub"><span class="toc-text">1.1 Hub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Bridge"><span class="toc-text">1.2 Bridge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Switch"><span class="toc-text">1.3 Switch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-MAC-Table"><span class="toc-text">1.4 MAC Table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-Transmitting-Frames"><span class="toc-text">1.5 Transmitting Frames</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-VLAN"><span class="toc-text">2. VLAN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%8E%B0%E5%9C%A8%E4%BC%81%E4%B8%9A%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="toc-text">2.1 现在企业网络结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%8E%B0%E6%9C%89%E8%AE%BE%E8%AE%A1%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">2.2 现有设计网络架构中的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-VLAN%E6%A6%82%E8%BF%B0"><span class="toc-text">2.3 VLAN概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-VLAN%E5%88%92%E5%88%86"><span class="toc-text">2.4 VLAN划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-VLAN-Trunking"><span class="toc-text">2.5 VLAN Trunking</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-VTP"><span class="toc-text">3. VTP</span></a></li></ol>
  </div>

    </div>
  </nav>

    <div id="page">
      <header id="masthead"><div class="site-header-inner">
  
  <button class="nav-mobile-button on-post" id="sidebarCollapse">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"/></svg>
  </button>
  
  


  <nav id="nav-top">
    
      
      <ul id="menu-top" class="nav-top-items on-post">
      
        
          <li class="menu-item">
            <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Zaf1ro">
              
              
                Github
              
            </a>
          </li>
        
      </ul>
    
  </nav>
</div>

      </header>
      <div id="content">
        
  <div class="primary">
    
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          VLAN
        
      </h1>
      <time class="post-time">
          06/15/17
      </time>
    </header>

    <div class="post-content">
      <h2 id="1-交换设备"><a href="#1-交换设备" class="headerlink" title="1. 交换设备"></a>1. 交换设备</h2><h3 id="1-1-Hub"><a href="#1-1-Hub" class="headerlink" title="1.1 Hub"></a>1.1 Hub</h3><ul>
<li>二层设备, 只能连接同一网段的设备</li>
<li>带宽平分</li>
<li>同一时间两个设备发送给Hub的信号会冲突</li>
<li>只能应用于少量的主机</li>
<li>某个设备发出的信息会被Hub连接的其他所有设备收到</li>
</ul>
<p><img src="/images/Network/VLAN/1.1_1.png" alt="Hub"></p>
<p>Host A发送给Host B信息, Host C和D也能收到信息</p>
<h3 id="1-2-Bridge"><a href="#1-2-Bridge" class="headerlink" title="1.2 Bridge"></a>1.2 Bridge</h3><ul>
<li>具有二层的过滤功能(根据MAC信息)</li>
<li>可以连接不同的网段</li>
<li>由于是软件来过滤和转发信息, 所以不能全速转发</li>
<li>具有少量端口</li>
<li>两个接口的传输速率必须相同</li>
</ul>
<p><img src="/images/Network/VLAN/1.2_1.png" alt="Bridge"></p>
<p>Host A发送给Host B信息, 其他Host不会收到信息</p>
<h3 id="1-3-Switch"><a href="#1-3-Switch" class="headerlink" title="1.3 Switch"></a>1.3 Switch</h3><ul>
<li>二层设备, 连接不同网段</li>
<li>由于是硬件处理, 可达到线速转发, 并实现过滤功能(基于MAC地址)</li>
<li>有大量端口</li>
<li>使用了微分段(Micro Segmentation)技术, 为每个网段都划分不同的冲突域(Collision Domain), 所以不会产生信号冲突</li>
<li>接口全双工模式(可同时收发信息)</li>
<li>接口速率调节(两端的传输速率可不同)</li>
</ul>
<p><img src="/images/Network/VLAN/1.3_1.png" alt="Bridge"></p>
<p>Host A发送给Host B信息, 其他Host不会收到信息</p>
<h3 id="1-4-MAC-Table"><a href="#1-4-MAC-Table" class="headerlink" title="1.4 MAC Table"></a>1.4 MAC Table</h3><p>Switch通过MAC Table实现过滤功能, 这样其他主机就不会收到信息, 因此减少了网络上的负荷并提高了安全性</p>
<ul>
<li>Switch启动时, MAC Table为空. </li>
<li>在收到第一个数据包后, 会记录该接口和源MAC地址. </li>
<li>由于不知道往哪个接口转发, 所以执行泛洪操作(flooding, 向所有接口转发).</li>
<li>目的主机在接受到数据包后会作出响应, Switch因此学习到了目的主机的MAC地址</li>
</ul>
<p>除了目标地址未知时进行的泛洪操作, Broadcast和Multicast也进行泛洪操作.</p>
<h3 id="1-5-Transmitting-Frames"><a href="#1-5-Transmitting-Frames" class="headerlink" title="1.5 Transmitting Frames"></a>1.5 Transmitting Frames</h3><p>Switch有三种传输数据包模式:</p>
<ul>
<li>Cut-Through: 最快, 最不可靠. 在接收到目的地址后立即转发, 不进行FCS校验.</li>
<li>Fragment-Free: 检查前64字节(因为冲突产生的数据包小于64字节), 并立即转发, 不进行FCS校验.</li>
<li>Store and Forward: 最可靠, 最慢. 完全读取数据包, 并进行FCS校验, 再进行转发.</li>
</ul>
<h2 id="2-VLAN"><a href="#2-VLAN" class="headerlink" title="2. VLAN"></a>2. VLAN</h2><h3 id="2-1-现在企业网络结构"><a href="#2-1-现在企业网络结构" class="headerlink" title="2.1 现在企业网络结构"></a>2.1 现在企业网络结构</h3><p>由于交换机的接口有限, 并且主机并不一定在同一楼层或者同一楼, 所以需要对网络进行分层.<br><img src="/images/Network/VLAN/2.1_1.png" alt="现在企业网络架构"></p>
<ul>
<li>最上面一层为接入层(Access Layer), 直接连接主机, 一般分布在大楼的每一层中. 接入层的设备通常为中低端设备, 不需要太高性能. 只具有基本的网络防护策略.</li>
<li>中间层为汇聚层(Distribution Layer), 一般布置在每一层的机房, 负责汇聚接入层的数据. 并且设备为多层交换机(具有路由功能), 并且一般为中高端设备. 具有一定的交换策略(数据的隔离和优先级选择等).</li>
<li>最下面一层为骨干层(Campus Backbone), 负责全网的数据交换和转发, 设备采用高端设备. 不做任何策略, 只负责高速转发数据.</li>
</ul>
<p>为了实现冗余性, 一般在多层之间采取多线互连, 这样能避免单点故障导致的网络不可用. </p>
<h3 id="2-2-现有设计网络架构中的问题"><a href="#2-2-现有设计网络架构中的问题" class="headerlink" title="2.2 现有设计网络架构中的问题"></a>2.2 现有设计网络架构中的问题</h3><ul>
<li>由于交换机不隔离Broadcast domain, 所以导致全网Broadcast domain增大</li>
<li>未知单播包和组播会导致泛洪, 所以导致全网转发效率降低</li>
<li>主机数量增加的同时导致管理变得困难</li>
<li>会导致未知的网络安全隐患</li>
</ul>
<h3 id="2-3-VLAN概述"><a href="#2-3-VLAN概述" class="headerlink" title="2.3 VLAN概述"></a>2.3 VLAN概述</h3><p>VLAN(Virtual LAN)通过对Switch中接口的逻辑划分实现了网络的分段(Segmentation), 灵活性(Flexibility)和安全性(Security). 这样就将物理上连接的接口通过逻辑划分来拆分成多个广播域和子网, 这样不同VLAN的广播, 泛洪都不会跨到其他VLAN之中.</p>
<h3 id="2-4-VLAN划分"><a href="#2-4-VLAN划分" class="headerlink" title="2.4 VLAN划分"></a>2.4 VLAN划分</h3><ul>
<li>按照物理位置划分: 每个楼层的主机一个VLAN, 或某些地区的主机一个VLAN</li>
<li>按照部门职能划分: 根据公司部门的不同来划分不同的VLAN</li>
<li>按照流量类型划分: 一般需要单独划分VLAN的Traffic type有以下几种:<ul>
<li>IP telephony(语音流量)</li>
<li>IP Multicast(组播流量, 可能是组内的视频流量)</li>
<li>Network management</li>
<li>Normal data</li>
</ul>
</li>
</ul>
<h3 id="2-5-VLAN-Trunking"><a href="#2-5-VLAN-Trunking" class="headerlink" title="2.5 VLAN Trunking"></a>2.5 VLAN Trunking</h3><p>由于VLAN的划分, 导致两个Switch上的数据无法通信. 如果想实现两个Switch的VLAN互连, 需要为每个VLAN多一个接口互连另一个Switch, 很明显这样是不可能的. 所以需要另一种方法来使得两个Swtich中相同VLAN能够通信.<br><img src="/images/Network/VLAN/2.5_1.png" alt="Trunk"></p>
<p>需要在每个Switch开一个Trunk接口, 并通过Trunk协议来区分不同的VLAN流量, 有两种Trunk协议:</p>
<ul>
<li><p>802.1Q<br>IEEE标准协议, 在原数据帧中插入4bytes, 但需要重新计算FCS. 如果Trunk线路中出现了没有Tag的流量, 则统一归为Native VLAN(一种特殊的VLAN划分)中.<br><img src="/images/Network/VLAN/2.5_2.png" alt="802.1Q"></p>
</li>
<li><p>ISL<br>思科的私有协议, 支持PVST, 并使用封装形式来处理数据帧, 这样就不会修改原数据帧<br><img src="/images/Network/VLAN/2.5_3.png" alt="ISL"></p>
</li>
</ul>
<h2 id="3-VTP"><a href="#3-VTP" class="headerlink" title="3. VTP"></a>3. VTP</h2><p>由于企业网络可能包含上百台Switch, 手工配置十分麻烦, 并且后期维护和修改也很复杂, 容易出现安全隐患. 为了简化大型网络配置, 可使用VTP协议.<br><img src="/images/Network/VLAN/3.1_1.png" alt="VTP"></p>
<p>VTP协议采用C&#x2F;S结构, 其中一台Switch作为Server, 其他的Swtich作为Client. 通过Server端组播VLAN配置信息来部署Client上的VLAN. 由于是Switch之间的连接, 所以需要通过Trunk接口连接. VLAN策略的发送是自动的, 并且是递归的, 每一个Client在接收到信息后会转发给所连接的剩下的Client.<br>还可以通过VTP Domain来划分Server上不同的策略, Client只会同步和其VTP Domain相同的策略信息. 以下是VTP协议在Switch中的三种模式:</p>
<ul>
<li>Server<ul>
<li>创建VLAN</li>
<li>删除VLAN</li>
<li>修改VLAN</li>
<li>发送VTP通告(2层协议, 周期性发送)</li>
<li>同步</li>
</ul>
</li>
<li>Client<ul>
<li>不能创建VLAN</li>
<li>不能删除VLAN</li>
<li>不能修改VLAN</li>
<li>发送VTP通告</li>
<li>同步</li>
</ul>
</li>
<li>Transparent<ul>
<li>创建本地VLAN</li>
<li>删除本地VLAN</li>
<li>修改本地VLAN</li>
<li>发送VTP通告</li>
<li>不同步</li>
</ul>
</li>
</ul>
<p>在不设置VTP协议时, Switch默认为Server mode. VTP server和client会同步最新的revision number(每一次更新server会将revision number加1), 从而通过revision number来让client判断该VTP通告是否为最新. </p>

    </div>

    <footer class="post-footer">
      
      <div class="post-tags">
        
          <a href="/tags/Network/">Network</a>
        
      </div>
      

      
      
  <nav class="post-nav">
    
      <a class="prev" href="/p/e9d2.html">
        <i class="icon-left"></i>
        <span class="prev-text nav-default">ctype.h</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/p/4ca2.html">
        <span class="next-text nav-default">VLSM (Variable-Length Subnet Mask)</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="icon-right"></i>
      </a>
    
  </nav>

      
    </footer>
  </article>

  </div>
  
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    showProcessingMessages: true,
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: false,
        skipTags: ["script","noscript","style","textarea"]
    },
    TeX: {
        Macros:{
            Arr: ["\\{ #1 \\}", 1],
            fi: "{f\\,\\!_i}",
            SS: ["{#1\\:\\!_#2}",2],
            SUBx: ["{\\:\\!_#1}",1],
            EXPx: ["{\\;\\!^#1}",1],
            Ss: ["{#1\\,\\!_#2}",2],
            subx: ["{\\,\\!_#1}",1]
        }
    }
});
</script>


      </div>
    </div>

    
<script type="text/javascript">
  var disqus_shortname = 'zaf1ro';
  var disqus_identifier = 'p/3b60.html';
  var disqus_title = "VLAN";

  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.6.0.min.js"></script>
  

  

    
    <script type="text/javascript">
(function(){"use strict";var Theme={};Theme.backToTop={register:function(){var $backToTop=$('#back-to-top');$(window).scroll(function(){if($(window).scrollTop()>100){$backToTop.fadeIn(1000)}else{$backToTop.fadeOut(1000)}});$backToTop.click(function(){$('body').animate({scrollTop:0})})}};Theme.fancybox={register:function(){if($.fancybox){$('.post').each(function(){$(this).find('img').each(function(){$(this).wrap('<a class="fancybox" href="'+this.src+'" title="'+this.alt+'"></a>')})});$('.fancybox').fancybox({openEffect:'elastic',closeEffect:'elastic'})}}};this.Theme=Theme}.call(this));
</script>

<script type="text/javascript">
$(document).ready(function(){if(themeConfig.fancybox.enable){Theme.fancybox.register()}Theme.backToTop.register()});
</script>
    
<script type="text/javascript">
var themeConfig = {
  fancybox: {
    enable: false
  },
};
</script>

    <script>
    $('table').wrap('<div style="overflow-x: auto;"></div>');
</script>
    
    <script>
$(document).ready(function () {
    $('#sidebarCollapse').on('click', function(){
        $('#sidebar').toggleClass('active');
    });

    $('#toc ol li a').on('click', function(){
        $('#sidebar').toggleClass('active');
    });
});
</script>
  </body>
</html>
