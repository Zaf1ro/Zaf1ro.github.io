<!DOCTYPE html>
<html lang="zh">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">



  <meta name="description" content="Entity"/>




  <meta name="keywords" content="Microservices," />


<meta name="google-site-verification" content="qy4gf0StWj627u-7aIP3WDCLBi3jPYXhm57UC7TUcok" />
<meta name="baidu-site-verification" content="XJoPG7ad2Z" />

<link rel="alternate" hreflang="x-default" href="https://zaf1ro.github.io/p/1f4.html" />
<link rel="alternate" hreflang="zh" href="https://zaf1ro.github.io/p/1f4.html" />




  <link rel="alternate" href="/default" title="Zaf1ro" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.jpeg?v=1.1" />



<link rel="canonical" href="https://zaf1ro.github.io/p/1f4.html"/>


<meta name="description" content="1. Definition当与domain experter交流需求时, 总会出现一些概念或实体, 且需要有标志来辨别其唯一性, 如顾客, 订单, 商品. 上述物品不能根据他们的属性所区分(如: 年龄, 金额, 类别), 只能由一个专属的身份标识(Identity)来辨识.Identity就是Entity的最大特征, entity的属性值可以相同或不同, 但每个entity都必须有唯一的ident">
<meta property="og:type" content="article">
<meta property="og:title" content="Entity">
<meta property="og:url" content="https://zaf1ro.github.io/p/1f4.html">
<meta property="og:site_name" content="Zaf1ro">
<meta property="og:description" content="1. Definition当与domain experter交流需求时, 总会出现一些概念或实体, 且需要有标志来辨别其唯一性, 如顾客, 订单, 商品. 上述物品不能根据他们的属性所区分(如: 年龄, 金额, 类别), 只能由一个专属的身份标识(Identity)来辨识.Identity就是Entity的最大特征, entity的属性值可以相同或不同, 但每个entity都必须有唯一的ident">
<meta property="og:locale">
<meta property="article:published_time" content="2021-04-22T14:56:30.000Z">
<meta property="article:modified_time" content="2024-08-20T16:43:04.036Z">
<meta property="article:tag" content="Microservices">
<meta name="twitter:card" content="summary">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />




    <title>
Entity - Zaf1ro
</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body>
  <nav id="sidebar" class="active on-post">
    <div id="third">
      <div id="sidebar-title">
        <h1 id="sidebar-title-text">
            <a href="/." class="logo">Home</a>
        </h1>
      </div>
      <div id="google-search">
  <script async src="https://cse.google.com/cse.js?cx=009060789867951546370:v3hkcobeuh9"></script>
  <div class="gcse-search"></div>
</div>
      
  <div id="toc">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Definition"><span class="toc-text">1. Definition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Features"><span class="toc-text">2. Features</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Example"><span class="toc-text">3. Example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Identity"><span class="toc-text">4. Identity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Design-an-Entity"><span class="toc-text">5. Design an Entity</span></a></li></ol>
  </div>

    </div>
  </nav>

    <div id="page">
      <header id="masthead"><div class="site-header-inner">
  
  <button class="nav-mobile-button on-post" id="sidebarCollapse">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"/></svg>
  </button>
  
  


  <nav id="nav-top">
    
      
      <ul id="menu-top" class="nav-top-items on-post">
      
        
          <li class="menu-item">
            <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Zaf1ro">
              
              
                Github
              
            </a>
          </li>
        
      </ul>
    
  </nav>
</div>

      </header>
      <div id="content">
        
  <div class="primary">
    
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Entity
        
      </h1>
      <time class="post-time">
          04/22/21
      </time>
    </header>

    <div class="post-content">
      <h2 id="1-Definition"><a href="#1-Definition" class="headerlink" title="1. Definition"></a>1. Definition</h2><p>当与domain experter交流需求时, 总会出现一些概念或实体, 且需要有标志来辨别其唯一性, 如顾客, 订单, 商品. 上述物品不能根据他们的属性所区分(如: 年龄, 金额, 类别), 只能由一个专属的身份标识(Identity)来辨识.<br>Identity就是Entity的最大特征, entity的属性值可以相同或不同, 但每个entity都必须有唯一的identity. 根据Eric Evans对Entity的描述: Entity是一个不由属性所定义的物品, 而是由<strong>连续性</strong>和<strong>唯一性</strong>所定义的线程, 其跨越系统的整个生命周期, 并可延展到系统之外. 举个例子, 银行账户作为一个entity, 银行系统要追踪其各种状态(余额, 交易记录等), 因此需要为每个账户分配一个ID, 否则不同的账户会混淆.</p>
<h2 id="2-Features"><a href="#2-Features" class="headerlink" title="2. Features"></a>2. Features</h2><p>以下是Entity的特征:</p>
<ul>
<li>拥有唯一的ID</li>
<li>当两个Entity拥有相同的ID时, 无论其状态如何, 都表示同一个物品</li>
<li>除了ID外, Entity的其他状态都是mutable(可变的)</li>
<li>Entity通常由很长的生命周期, 甚至不会被删除</li>
<li>一般来说, Entity会有自己的一套CURD操作, 以应对状态的改变</li>
</ul>
<p>系统中Entity的种类越多, 系统的复杂度越高, 因此需尽量减少Entity的使用. 举个例子, 当设计一个场馆的售票系统时, 场馆的<strong>座位</strong>可以作为entity, Entity的ID可用其位置(第几排第几列)作为唯一标示, 这样用户可购买对号座; 但如果场馆的座位并不需要预定, 而是用户先进先得, 那就不需要将座位当做entity, 只需记录座位的数量.</p>
<h2 id="3-Example"><a href="#3-Example" class="headerlink" title="3. Example"></a>3. Example</h2><p>以下是Entity的abstract class(written in TypeScript):</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Entity</span>&lt;<span class="title class_">Id</span>, <span class="title class_">Props</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="title class_">Id</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">props</span>: <span class="title class_">Props</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="title function_">constructor</span>(<span class="params"><span class="attr">id</span>: <span class="title class_">Id</span>, <span class="attr">props</span>: <span class="title class_">Props</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span> = props;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="title function_">equals</span>(obj?: <span class="title class_">Entity</span>&lt;<span class="title class_">Id</span>, <span class="title class_">Props</span>&gt;): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码中, <strong>equals</strong>函数用于判断两个entity是否表示同一物品.</p>
<h2 id="4-Identity"><a href="#4-Identity" class="headerlink" title="4. Identity"></a>4. Identity</h2><p>Entity的Identity有多种产生方式:</p>
<ul>
<li>用户输入(User Input): 当用户输入Email地址, 昵称, 或驾照号码, 可使用该信息作为Entity的Identity. 但问题在于这些信息规范不一, 且存在重复的可能性, 所以大多数情况下, 只把这些数据用于搜索或分类, 而不作为Entity的Identity.</li>
<li>持久性框架(persistence framework): 这是最常见生产Identity的方式, 例如: SQL中使用<strong>AUTO_INCREMENT</strong>让ID自动递增, 或让数据库生成一个唯一ID. 这种做法的好处是: 减少程序的复杂性, 将工作交由persistence layer处理; 但缺点是, 生成的ID不利于阅读, 且需要考虑生成ID时是否需要将entity持久化.</li>
<li>程序生成(Program): 这种方法可以更容易地掌握ID的生成时机, 也更易于开发者阅读. 例如, 一笔订单可以用<strong>order-20210426-abcdefgh-1234</strong>作为ID.</li>
<li>Bounded Context: 由其他Bounded Context提供ID, 这种方法不仅要考虑本端的Entity, 还需要考虑外部Bounded Context的更改情况.</li>
</ul>
<h2 id="5-Design-an-Entity"><a href="#5-Design-an-Entity" class="headerlink" title="5. Design an Entity"></a>5. Design an Entity</h2><p>以下是设计一个Entity的步骤:</p>
<ol>
<li>划分出关键属性, 将一些用于搜索或分类的属性留在Entity内部, 其他属性放入Value Object中.</li>
<li>生成Entity的Identity</li>
<li>找到关键行为与对应的业务规则, 按照Ubiquitous Language</li>
</ol>
<p>例如, 我们有一个User class, 其需要两个属性: 姓名和地址, 且这两个属性都可以被更改, 但修改姓名时有个前途: 该User必须处于一个有效状态, 而不是已注销状态, 且姓名不能少于两个character.</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">AddressProps</span> &#123;</span><br><span class="line">  <span class="attr">city</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">county</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">street</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">detail</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">extends</span> <span class="title class_ inherited__">ValueObject</span>&lt;<span class="title class_">AddressProps</span>&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">active</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">address</span>: <span class="title class_">Address</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Entity</span>&lt;<span class="built_in">string</span>, <span class="title class_">UserProps</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">changeName</span>(<span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// check the length of username</span></span><br><span class="line">    <span class="keyword">if</span> (name.<span class="property">length</span> &lt; <span class="string">&#x27;2&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// error handling</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">changeAddress</span>(<span class="attr">address</span>: <span class="title class_">Address</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">address</span> = <span class="variable language_">this</span>.<span class="property">address</span>.<span class="title function_">update</span>(address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">createUser</span>(<span class="attr">parmas</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">address</span>: <span class="title class_">Address</span>;</span><br><span class="line">  &#125;): [<span class="built_in">string</span>, <span class="title class_">User</span>] &#123;</span><br><span class="line">    <span class="comment">// check the length of username</span></span><br><span class="line">    <span class="keyword">if</span> (name.<span class="property">length</span> &lt; <span class="string">&#x27;2&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> [<span class="string">&#x27;Name length should be less than 2&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      <span class="literal">undefined</span>,</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">User</span>(params.<span class="property">id</span>, &#123;</span><br><span class="line">        <span class="attr">name</span>: params.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">address</span>: params.<span class="property">address</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">equals</span>(obj?: <span class="title class_">Entity</span>&lt;<span class="built_in">string</span>, <span class="title class_">UserProps</span>&gt;): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    <footer class="post-footer">
      
      <div class="post-tags">
        
          <a href="/tags/Microservices/">Microservices</a>
        
      </div>
      

      
      
  <nav class="post-nav">
    
      <a class="prev" href="/p/bc4.html">
        <i class="icon-left"></i>
        <span class="prev-text nav-default">Value Object</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/p/7dc1.html">
        <span class="next-text nav-default">Context Mapping</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="icon-right"></i>
      </a>
    
  </nav>

      
    </footer>
  </article>

  </div>
  
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    showProcessingMessages: true,
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: false,
        skipTags: ["script","noscript","style","textarea"]
    },
    TeX: {
        Macros:{
            Arr: ["\\{ #1 \\}", 1],
            fi: "{f\\,\\!_i}",
            SS: ["{#1\\:\\!_#2}",2],
            SUBx: ["{\\:\\!_#1}",1],
            EXPx: ["{\\;\\!^#1}",1],
            Ss: ["{#1\\,\\!_#2}",2],
            subx: ["{\\,\\!_#1}",1]
        }
    }
});
</script>


      </div>
    </div>

    
<script type="text/javascript">
  var disqus_shortname = 'zaf1ro';
  var disqus_identifier = 'p/1f4.html';
  var disqus_title = "Entity";

  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.6.0.min.js"></script>
  

  

    
    <script type="text/javascript">
(function(){"use strict";var Theme={};Theme.backToTop={register:function(){var $backToTop=$('#back-to-top');$(window).scroll(function(){if($(window).scrollTop()>100){$backToTop.fadeIn(1000)}else{$backToTop.fadeOut(1000)}});$backToTop.click(function(){$('body').animate({scrollTop:0})})}};Theme.fancybox={register:function(){if($.fancybox){$('.post').each(function(){$(this).find('img').each(function(){$(this).wrap('<a class="fancybox" href="'+this.src+'" title="'+this.alt+'"></a>')})});$('.fancybox').fancybox({openEffect:'elastic',closeEffect:'elastic'})}}};this.Theme=Theme}.call(this));
</script>

<script type="text/javascript">
$(document).ready(function(){if(themeConfig.fancybox.enable){Theme.fancybox.register()}Theme.backToTop.register()});
</script>
    
<script type="text/javascript">
var themeConfig = {
  fancybox: {
    enable: false
  },
};
</script>

    <script>
    $('table').wrap('<div style="overflow-x: auto;"></div>');
</script>
    
    <script>
$(document).ready(function () {
    $('#sidebarCollapse').on('click', function(){
        $('#sidebar').toggleClass('active');
    });

    $('#toc ol li a').on('click', function(){
        $('#sidebar').toggleClass('active');
    });
});
</script>
  </body>
</html>
